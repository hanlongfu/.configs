"use strict";var F=Object.defineProperty;var ee=Object.getOwnPropertyDescriptor;var te=Object.getOwnPropertyNames;var ne=Object.prototype.hasOwnProperty;var se=(e,t)=>{for(var s in t)F(e,s,{get:t[s],enumerable:!0})},ie=(e,t,s,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of te(t))!ne.call(e,o)&&o!==s&&F(e,o,{get:()=>t[o],enumerable:!(n=ee(t,o))||n.enumerable});return e};var re=e=>ie(F({},"__esModule",{value:!0}),e);var oe={};se(oe,{default:()=>Z});module.exports=re(oe);var D=require("react");var f=require("@raycast/api"),N=require("child_process"),k=require("crypto"),i=require("fs"),v=require("path");var w=e=>{let t=Math.floor(e/3600),s=String(Math.floor(e%3600/60)).padStart(2,"0"),n=String(Math.floor(e%60)).padStart(2,"0");return`${t===0?"":t+":"}${s}:${n}`};var b=e=>(e.d1=e.d1=="----"?void 0:e.d1,e.d2=e.d2=="----"?void 0:e.d2,Math.round((e.d1?new Date(e.d1):new Date).getTime()-(e.d2?new Date(e.d2):new Date).getTime())/1e3);var c=require("@raycast/api"),O=require("fs");var E=e=>{let t=(0,c.getPreferenceValues)();if(e.launchedFromMenuBar||t.closeWindowOnTimerStart){let s=e.isErr?"\u26A0\uFE0F":"\u{1F389}";return(0,c.showHUD)(`${s} ${e.msg}`),(0,c.popToRoot)()}else(0,c.showToast)({style:e.isErr?c.Toast.Style.Failure:c.Toast.Style.Success,title:e.msg})},J=async()=>{let e=c.environment.supportPath+"/ringContinuouslyWarningShown";if(!(0,c.getPreferenceValues)().ringContinuously||(0,O.existsSync)(e))return!0;let s=await(0,c.confirmAlert)({title:"Ring Continuously is enabled!",icon:c.Icon.Bell,message:'When the timer rings, you will need to use the "Stop Running Timer" command or stop the timer in the "Manage Timers" command to dismiss the sound. You can configure this in your Raycast settings.'});return s&&(0,O.writeFileSync)(e,""),s};var x=require("process"),h=f.environment.supportPath+"/customTimers.json",M=f.environment.supportPath+"/defaultPresetVisibles.json",A=e=>{try{(0,i.unlinkSync)(e)}catch(t){if(t instanceof Error&&!t.message.includes("ENOENT"))throw t}},L=(e=!1)=>{let t=(0,f.getPreferenceValues)();return parseFloat(t.volumeSetting)>5?(E({msg:"Timer alert volume should not be louder than 5 (it can get quite loud!)",launchedFromMenuBar:e,isErr:!0}),!1):!0};async function V({timeInSeconds:e,timerName:t="Untitled",launchedFromMenuBar:s=!1,selectedSound:n="default"}){if(!await J())return;let u=(f.environment.supportPath+"/"+new Date().toISOString()+"---"+e+".timer").replace(/:/g,"__"),a=(0,f.getPreferenceValues)();if(a.ringContinuously){let S=`${u}`.replace(".timer",".dismiss");(0,i.writeFileSync)(S,".dismiss file for Timers")}let l=H(u,t,e,n),y=(0,N.exec)(l,(S,m)=>{if(S){console.log(`error: ${S.message}`);return}if(m){console.log(`stderr: ${m}`);return}}),P={name:t,pid:y.pid,lastPaused:"---",pauseElapsed:0,selectedSound:n==="default"?a.selectedSound:n};(0,i.writeFileSync)(u,JSON.stringify(P)),E({msg:`Timer "${t}" started for ${w(e)}!`,launchedFromMenuBar:s,isErr:!1})}function H(e,t,s,n){let o=(0,f.getPreferenceValues)(),u=`${f.environment.assetsPath+"/"+(n==="default"?o.selectedSound:n)}`,a=[`sleep ${s}`];a.push(`if [ -f "${e}" ]; then osascript -e 'display notification "Timer \\"${t}\\" complete" with title "Ding!"'`);let l=o.selectedSound==="speak_timer_name"?`say ${t}`:`afplay "${u}" --volume ${o.volumeSetting.replace(",",".")}`;if(a.push(l),o.ringContinuously){let y=`${e}`.replace(".timer",".dismiss");a.push(`while [ -f "${y}" ]; do ${l}; done`)}return a.push(`rm "${e}"; else echo "Timer deleted"; fi`),a.join(" ; ")}function _(e){let t=f.environment.supportPath+"/"+e,s=t.replace(".timer",".dismiss");A(t),A(s)}function U(e,t){let s=f.environment.supportPath+"/"+e;(0,x.kill)(t);let n=(0,i.readFileSync)(s).toString(),o=JSON.parse(n);o.pid=void 0,o.lastPaused=new Date,(0,i.writeFileSync)(s,JSON.stringify(o))}function j(e){let t=f.environment.supportPath+"/"+e.originalFile,s=H(t,e.name,e.timeLeft,e.selectedSound),n=(0,N.exec)(s),o=(0,i.readFileSync)(t).toString(),u=JSON.parse(o);u.pauseElapsed=u.pauseElapsed+b({d2:e.lastPaused}),u.lastPaused="---",u.pid=n.pid,(0,i.writeFileSync)(t,JSON.stringify(u))}function W(){let e=[];return(0,i.readdirSync)(f.environment.supportPath).forEach(s=>{if((0,v.extname)(s)==".timer"){let n={name:"",secondsSet:-99,timeLeft:-99,originalFile:s,timeEnds:new Date,pid:void 0,lastPaused:"---",pauseElapsed:0,selectedSound:"default"},o=(0,i.readFileSync)(f.environment.supportPath+"/"+s).toString();try{let l=JSON.parse(o);n.name=l.name,n.pid=l.pid,n.lastPaused=l.lastPaused,n.pauseElapsed=l.pauseElapsed,n.selectedSound=l.selectedSound}catch(l){if(!(l instanceof SyntaxError))throw l;n.name=o}let u=s.split("---");n.secondsSet=Number(u[1].split(".")[0]);let a=u[0].replace(/__/g,":");n.timeEnds=new Date(a),n.timeEnds.setSeconds(n.timeEnds.getSeconds()+n.secondsSet+n.pauseElapsed),n.timeLeft=Math.max(0,Math.round(n.pid===void 0?n.secondsSet-b({d1:n.lastPaused==="---"?void 0:n.lastPaused,d2:new Date(a)})+n.pauseElapsed:b({d1:n.timeEnds}))),e.push(n)}}),e.sort((s,n)=>s.timeLeft-n.timeLeft),e}function C(){(0,i.existsSync)(h)||(0,i.writeFileSync)(h,JSON.stringify({}))}function Y(e){C();let t=JSON.parse((0,i.readFileSync)(h,"utf8"));t[(0,k.randomUUID)()]=e,(0,i.writeFileSync)(h,JSON.stringify(t))}function G(){C();let e=JSON.parse((0,i.readFileSync)(h,"utf8"));return Object.fromEntries(Object.entries(e).map(([t,s])=>s.showInMenuBar===void 0?[t,{...s,showInMenuBar:!0}]:[t,s]))}function q(e){C();let t=JSON.parse((0,i.readFileSync)(h,"utf8"));delete t[e],(0,i.writeFileSync)(h,JSON.stringify(t))}function z(e){C();let t=JSON.parse((0,i.readFileSync)(h,"utf8")),s=t[e].showInMenuBar;t[e].showInMenuBar=s===void 0?!1:!s,(0,i.writeFileSync)(h,JSON.stringify(t))}var K=()=>{if(!(0,i.existsSync)(M)){let t={"2M":!0,"5M":!0,"10M":!0,"15M":!0,"30M":!0,"45M":!0,"60M":!0,"90M":!0};return(0,i.writeFileSync)(M,JSON.stringify(t)),t}return JSON.parse((0,i.readFileSync)(M,"utf8"))},Q=e=>{let t=JSON.parse((0,i.readFileSync)(M,"utf8"));t[e]=!t[e],(0,i.writeFileSync)(M,JSON.stringify(t))};var p=require("@raycast/api");function I(){let[e,t]=(0,D.useState)(void 0),[s,n]=(0,D.useState)({}),[o,u]=(0,D.useState)(e===void 0),a=()=>{C();let r=W();t(r);let T=G();n(T),u(!1)};return{timers:e,customTimers:s,isLoading:o,refreshTimers:a,handleStartTimer:r=>{L(r.launchedFromMenuBar)&&(V(r),a())},handlePauseTimer:r=>{if(r.pid==null&&r.lastPaused==="---")return(0,p.showToast)({style:p.Toast.Style.Failure,title:"This timer does not support pausing. Try restarting it to enable pausing."});U(r.originalFile,r.pid),a()},handleUnpauseTimer:r=>{if(r.pid==null&&r.lastPaused==="---")return(0,p.showToast)({style:p.Toast.Style.Failure,title:"This timer does not support pausing. Try restarting it to enable pausing."});j(r),a()},handleStopTimer:r=>{t(e?.filter(T=>T.originalFile!==r.originalFile)),_(r.originalFile),a()},handleStartCT:({customTimer:r,launchedFromMenuBar:T})=>{L(T)&&(V({timeInSeconds:r.timeInSeconds,launchedFromMenuBar:T,timerName:r.name,selectedSound:r.selectedSound}),a())},handleCreateCT:r=>{let T={name:r.name,timeInSeconds:r.secondsSet,selectedSound:"default",showInMenuBar:!0};Y(T),a()},handleDeleteCT:async r=>{let T={title:"Delete this preset?",icon:p.Icon.Trash,message:"You won't be able to recover it.",dismissAction:{title:"Cancel",style:p.Alert.ActionStyle.Cancel},primaryAction:{title:"Delete",style:p.Alert.ActionStyle.Destructive}};await(0,p.confirmAlert)(T)&&(q(r),a())},handleToggleCTVisibility:async r=>{z(r),a()}}}var d=require("@raycast/api"),X=require("react");var R=require("react");function $(){let e=[{key:"2M",title:"2 Minute Timer",seconds:120},{key:"5M",title:"5 Minute Timer",seconds:300},{key:"10M",title:"10 Minute Timer",seconds:600},{key:"15M",title:"15 Minute Timer",seconds:900},{key:"30M",title:"30 Minute Timer",seconds:1800},{key:"45M",title:"45 Minute Timer",seconds:2700},{key:"60M",title:"60 Minute Timer",seconds:3600},{key:"90M",title:"90 Minute Timer",seconds:5400}],[t,s]=(0,R.useState)(),[n,o]=(0,R.useState)(t===void 0),u=()=>{s(K()),o(!1)};return{defaultPresets:e,defaultVisibles:t,isLoadingVisibles:n,refreshDefaultVisibles:u,handleDefaultPresetToggle:l=>{Q(l),u()}}}var g=require("react/jsx-runtime");function Z(){let{customTimers:e,isLoading:t,refreshTimers:s,handleToggleCTVisibility:n}=I(),{defaultPresets:o,defaultVisibles:u,isLoadingVisibles:a,refreshDefaultVisibles:l,handleDefaultPresetToggle:y}=$(),P={tag:{value:"Hidden",color:d.Color.Red}},S={tag:{value:"Visible",color:d.Color.Green}};return(0,X.useEffect)(()=>{s(),l()},[]),(0,g.jsxs)(d.List,{isLoading:t&&a,children:[(0,g.jsx)(d.List.Section,{title:"Custom Presets",children:Object.keys(e).sort((m,B)=>e[m].timeInSeconds-e[B].timeInSeconds).map(m=>(0,g.jsx)(d.List.Item,{title:e[m].name,subtitle:w(e[m].timeInSeconds),icon:d.Icon.Clock,accessories:[e[m].showInMenuBar?S:P],actions:(0,g.jsx)(d.ActionPanel,{children:(0,g.jsx)(d.Action,{title:e[m].showInMenuBar?"Hide In Menu Bar":"Show In Menu Bar",onAction:()=>n(m)})})},m))}),(0,g.jsx)(d.List.Section,{title:"Default Presets",children:o.map(m=>(0,g.jsx)(d.List.Item,{title:m.title,icon:d.Icon.Hourglass,accessories:[u?.[m.key]?S:P],actions:(0,g.jsx)(d.ActionPanel,{children:(0,g.jsx)(d.Action,{title:u?.[m.key]?"Hide In Menu Bar":"Show In Menu Bar",onAction:()=>y(m.key)})})},m.key))})]})}
